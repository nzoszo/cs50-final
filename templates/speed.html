{% extends "layout.html" %}

{% block title %}
    Speed!
{% endblock %}

{% block main %}
    <div id="card-container">

    </div>

    <button id="startGame" onclick="startGame()">Play!</button>

    <script>
        /* Create deck of cards */
        let deck = [];
        const suits = ["Hearts", "Diamonds", "Clubs", "Spades"];
        const ranks = ["Ace", "2", "3", "4", "5", "6", "7", "8", "9", "10", "Jack", "Queen", "King"];
        // Loops through suits and ranks
        for (let suit of suits) {
            for (let rank of ranks) {
                // Assigns each "card" object with current suit, rank, and image
                const card = {
                    suit,
                    rank,
                    image: `../static/card_images/${rank.toLowerCase()}_of_${suit.toLowerCase()}.png`,
                    back: `../static/card_images/card_backside.png`
                };
                // Adds each card to a deck of cards
                deck.push(card);
            };
        };
        /* Stars with shuffled deck */
        document.addEventListener("DOMContentLoaded", function() {
            shuffle();
        });


        /* Load and connect images to deck array */
        function loadCards() {
            const cardContainer = document.getElementById("card-container");
            // Removes current deck of cards before loading new deck
            if (cardContainer.childElementCount > 0) {
                cardContainer.innerHTML = "";
            };
            // Loads in new deck of cards
            deck.forEach((card) => {
                // Each card element
                const cardElement = document.createElement("div");
                cardElement.className = "card";
                // Each card's image
                const cardImage = document.createElement("img");
                cardImage.src = card.back;
                //cardImage.alt = `${card.rank} of ${card.suit}`;
                cardImage.className = "card-image";
                cardElement.appendChild(cardImage);
                // Add card 
                cardContainer.appendChild(cardElement);
                });
        };

        /* Shuffle deck of cards */
        function shuffle() {
            let currentIndex = deck.length;
            // Keep going until last card is swapped
            while (currentIndex != 0) {
                // Choose remaining card
                let randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;
                // Swap last remaining card with random remaining card
                [deck[currentIndex], deck[randomIndex]] = [deck[randomIndex], deck[currentIndex]];
            };
            // Reload card images
            loadCards();
        };
        
        /* Starts Game */
        function startGame() {
            document.getElementById("startGame").remove()
            const topLeftDeck = deck.slice(0, 20);
            const bottomRightDeck = deck.slice(20, 40);
            const middleLeftDeck = deck.slice(40, 46);
            const middleRightDeck = deck.slice(46, 52);

            
            console.log(topLeftDeck);
            console.log(bottomRightDeck);
            console.log(middleLeftDeck);
            console.log(middleRightDeck);
            for (let i = 0; i < topLeftDeck.length; i++) {
                console.log(topLeftDeck[i].image);
            };

            // Get the card elements
            const cardElements = document.querySelectorAll('.card');

            // Animate the cards
            cardElements.forEach((cardElement, index) => {
                const pileIndex = Math.floor(index / 13); // 13 cards per pile
                const xCoordinate = getPileXCoordinate(pileIndex);
                const yCoordinate = getPileYCoordinate(pileIndex);

                cardElement.style.animation = 'splitCards 1s forwards';
                cardElement.style.animationDelay = `${index * 50}ms`; // stagger the animation
                cardElement.style.transform = `translate(${xCoordinate}px, ${yCoordinate}px)`;
            });
            }

        // Helper functions to calculate the x and y coordinates for each pile
        function getPileXCoordinate(pileIndex) {
            switch (pileIndex) {
                case 0:
                    return 0; // top-left pile
                case 1:
                    return 1200; // bottom-right pile
                case 2:
                    return 800; // middle-left pile
                case 3:
                    return 300; // middle-right pile
                default:
                    return 0;
            };
        };

        function getPileYCoordinate(pileIndex) {
            switch (pileIndex) {
                case 0:
                    return 0; // top-left pile
                case 1:
                    return 400; // bottom-right pile
                case 2:
                    return 300; // middle-left pile
                case 3:
                    return 300; // middle-right pile
                default:
                    return 0;
            };
        };
    </script>
{% endblock %}

<!--
Pseudocode:
Beginning:

Shuffle Deck:
    20 cards go top left for enemy -- split into deck of 5 and 15
    20 cards go bottom right player -- split into deck of 5 and 15
    remaining 12 split 6 and 6 left and right of center of table -- (5 1 1 5)
Deal 20 cards to each player
Lay the rest in 4 piles in middle -- 5 1 1 5
Distribute 5 cards from each player's deck to player (only visible to player)
Game Rules:
Cards
Players have to rid their deck by placing their cards on the middle 2 
Flip over left and right cards if current decks are unplayable
If players can't play, draw from personal deck
Players can only have 5 cards max at all times
Gamemodes:
More than 2 players
Can play more than one card at once
Include joker cards as wild
-->